<head>
    <title>Interactive Quiz</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        #examDropdown {
            display: none; /* Initially hide the select element */
        }
    </style>
</head>
<body>
<body>  

    
    <h1>Select an Exam</h1>
    <select id="examDropdown" onchange="updateCollsel()">
    </select>
    <p id="collselValue" hidden >collsel = 0</p>
</body>
    <div id="quiz-container"></div>
    
    
    
    
    <script type="text/javascript"> 
    
        
    async function showInput() {
            const { value: input } = await Swal.fire({
                title: 'Enter a number',
                input: 'text',
                inputLabel: 'Number',
                inputPlaceholder: 'Enter AtM',
                allowOutsideClick:false,
                showCancelButton: true
            });

            if (input === '6702') {
                document.getElementById('examDropdown').style.display = 'block';
            }else{

                alert(" please this  product is  of T-smart solution ")
            }
        }

        // Call the function to show the Swal.fire input dialog
        showInput();




   
      var collsel=0;
      function populateDropdown() {
            var examDropdown = document.getElementById("examDropdown");
              
            for (var i = 0; i <= 40; i++) {
                var option = document.createElement("option");
                option.value = (i - 1) * 20;
                option.text = "Exam " + i;
                if(i===0)
                { 
               
                option.text="select the exam";
                examDropdown.add(option)} else{
                 examDropdown.add(option);
                }
               
            }
        }

        function updateCollsel() {
            var examDropdown = document.getElementById("examDropdown");
            var collsel2 = examDropdown.value;
            document.getElementById("collselValue").innerText = "collsel = " + collsel2;
            
            alert("loaded"+collsel2)
            collsel=(collsel2*1)+0;
             loaderthem()
        }

        window.onload = function() {
            populateDropdown();
        };
      
     
    
     
    function loaderthem() {
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(init);

        function init() {
            var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/133wNh6NkNMOkGIv33y2dkajMgdAhvF6a0wVw46yAS2I/gviz/tq?gid=0');
            query.send(handleQueryResponse);
        }

        function handleQueryResponse(response) {
            if (response.isError()) {
                alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }

            var data = response.getDataTable();
            var questions = [];
            for (var i =collsel ; i < data.getNumberOfRows(); i++) {
                var question = {
                    text: data.getValue(i, 1),  // Column B
                    options: [
                        data.getValue(i, 3),  // Column D
                        data.getValue(i, 4),  // Column E
                        data.getValue(i, 5),  // Column F
                        data.getValue(i, 6),  // Column G
                        data.getValue(i, 7)   // Column H
                    ],
                    answer: data.getValue(i, 8) // Column I
                };
                questions.push(question);
            }

            startQuiz(questions);
        }

        function startQuiz(questions) {
            let score = 0;
            let questionIndex = 0;
            let userAnswers = [];

            function askQuestion() {
                if (questionIndex >= 20 || questionIndex >= questions.length) {
                    showResults();
                    return;
                }

                let question = questions[questionIndex];
                Swal.fire({
                    title: `Question ${questionIndex + 1}`,
                    allowOutsideClick:false,
                    html: `
                        <div>${question.text}</div>
                        <div>
                            <input type="radio" id="option1" name="quiz" value="1">
                            <label for="option1">${question.options[0]}</label>
                        </div>
                        <div>
                            <input type="radio" id="option2" name="quiz" value="2">
                            <label for="option2">${question.options[1]}</label>
                        </div>
                        <div>
                            <input type="radio" id="option3" name="quiz" value="3">
                            <label for="option3">${question.options[2]}</label>
                        </div>
                        <div>
                            <input type="radio" id="option4" name="quiz" value="4">
                            <label for="option4">${question.options[3]}</label>
                        </div>
                        <div>
                            <input type="radio" id="option5" name="quiz" value="5">
                            <label for="option5">${question.options[4]}</label>
                        </div>
                    `,
                    preConfirm: () => {
                        const selectedOption = document.querySelector('input[name="quiz"]:checked');
                        if (!selectedOption) {
                            Swal.showValidationMessage('You need to choose an option!');
                            return false;
                        }
                        return selectedOption.value;
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        let userAnswer = parseInt(result.value);
                        userAnswers.push({
                            question: question.text,
                            selected: userAnswer,
                            correct: question.answer
                        });
                        if (userAnswer == question.answer) {
                            score++;
                        }
                        questionIndex++;
                        askQuestion();
                    }
                });
            }

            function showResults() {
                let resultHtml = `<h3>Quiz Finished! Your score is ${score} out of ${Math.min(20, questions.length)}</h3><ol>`;
                userAnswers.forEach((answer, index) => {
                    resultHtml += `<li><strong>Question ${index + 1}:</strong> ${answer.question}<br> 
                                   <strong>Your Answer:</strong> ${answer.selected}<br> 
                                   <strong>Correct Answer:</strong> ${answer.correct}</li><br>`;
                });
                resultHtml += `</ol>`;

                Swal.fire({
                    title: 'Results',
                    allowOutsideClick:false,
                    html: resultHtml,
                    width: '60%',
                    allowOutsideClick: false
                });
            }

            askQuestion();
        }
        }
    </script>
</body>
</html>
